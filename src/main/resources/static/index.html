<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Platform APIs with K6 Load Testing</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <div class="header">
        <div class="header-content">
            <div>
                <div class="title-section">
                    <h1>Web Platform APIs</h1>
                    <span class="version-badge">v1</span>
                    <span class="spec-badge">OAS3</span>
                    <span class="k6-badge">K6 READY</span>
                </div>
                <div class="url-info">/openapi/web.json - Load Testing Enabled</div>
            </div>
            <button class="authorize-btn">
                Authorize üîí
            </button>
        </div>
    </div>

    <div class="base-url-section">
        <div class="form-group">
            <label for="baseUrl">Base URL:</label>
            <input type="text" id="baseUrl" value="http://localhost:8080" placeholder="Enter base URL">
        </div>
    </div>

    <!-- User Section -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('user-section')">
            <h2>user</h2>
            <span class="expand-icon" id="user-icon">‚ñº</span>
        </div>
        <div class="section-content" id="user-section">

            <!-- Login API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('login-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/login</span>
                        <span class="api-description">Î°úÍ∑∏Ïù∏</span>
                    </div>
                    <span class="expand-icon" id="login-icon">‚ñº</span>
                </div>
                <div class="api-details" id="login-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>Î°úÍ∑∏Ïù∏ Î°úÏßÅ</p>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="loginRequest">loginRequest (JSON)</label>
                            <textarea id="loginRequest" placeholder="Enter JSON request body">{
  "username": "user@example.com",
  "password": "password123"
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "username": "user@example.com",
                            "password": "password123"
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/login', 'loginRequest', 'login-response')">
                            Execute API
                        </button>
                        <button class="k6-btn" onclick="toggleK6Section('login')">
                            ‚ö° K6 Load Test
                        </button>
                    </div>

                    <div class="k6-section" id="login-k6-section">
                        <h5>K6 Load Test Configuration</h5>

                        <div class="k6-stats">
                            <h6>üìä Test Overview</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="login-total-duration">11s</div>
                                    <div class="stat-label">Total Duration</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="login-max-users">100</div>
                                    <div class="stat-label">Max Users</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="login-total-requests">~500</div>
                                    <div class="stat-label">Est. Requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="k6-config-grid">
                            <div class="k6-config-item">
                                <label>üöÄ Ramp Up Duration (s)</label>
                                <input type="number" id="login-ramp-up" value="3" min="1" max="60" onchange="updateK6Config('login')">
                            </div>
                            <div class="k6-config-item">
                                <label>üë• Target Users</label>
                                <input type="number" id="login-target-users" value="100" min="1" max="10000" onchange="updateK6Config('login')">
                            </div>
                            <div class="k6-config-item">
                                <label>‚è±Ô∏è Hold Duration (s)</label>
                                <input type="number" id="login-hold-duration" value="5" min="1" max="300" onchange="updateK6Config('login')">
                            </div>
                            <div class="k6-config-item">
                                <label>üìâ Ramp Down Duration (s)</label>
                                <input type="number" id="login-ramp-down" value="3" min="1" max="60" onchange="updateK6Config('login')">
                            </div>
                        </div>

                        <button class="copy-btn" onclick="copyK6Script('login-k6-output')">üìã Copy K6 Script</button>
                        <div class="k6-script-output" id="login-k6-output"></div>
                    </div>

                    <div class="response-section" id="login-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="login-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- Signup API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('signup-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/signup</span>
                        <span class="api-description">ÌöåÏõêÍ∞ÄÏûÖ</span>
                    </div>
                    <span class="expand-icon" id="signup-icon">‚ñº</span>
                </div>
                <div class="api-details" id="signup-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>ÌöåÏõêÍ∞ÄÏûÖ Î°úÏßÅ</p>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="signupRequest">signupRequest (JSON)</label>
                            <textarea id="signupRequest" placeholder="Enter JSON request body">{
  "username": "newuser@example.com",
  "password": "password123"
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "username": "newuser@example.com",
                            "password": "password123"
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/signup', 'signupRequest', 'signup-response')">
                            Execute API
                        </button>
                        <button class="k6-btn" onclick="toggleK6Section('signup')">
                            ‚ö° K6 Load Test
                        </button>
                    </div>

                    <div class="k6-section" id="signup-k6-section">
                        <h5>K6 Load Test Configuration</h5>

                        <div class="k6-stats">
                            <h6>üìä Test Overview</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="signup-total-duration">11s</div>
                                    <div class="stat-label">Total Duration</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="signup-max-users">100</div>
                                    <div class="stat-label">Max Users</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="signup-total-requests">~500</div>
                                    <div class="stat-label">Est. Requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="k6-config-grid">
                            <div class="k6-config-item">
                                <label>üöÄ Ramp Up Duration (s)</label>
                                <input type="number" id="signup-ramp-up" value="3" min="1" max="60" onchange="updateK6Config('signup')">
                            </div>
                            <div class="k6-config-item">
                                <label>üë• Target Users</label>
                                <input type="number" id="signup-target-users" value="100" min="1" max="10000" onchange="updateK6Config('signup')">
                            </div>
                            <div class="k6-config-item">
                                <label>‚è±Ô∏è Hold Duration (s)</label>
                                <input type="number" id="signup-hold-duration" value="5" min="1" max="300" onchange="updateK6Config('signup')">
                            </div>
                            <div class="k6-config-item">
                                <label>üìâ Ramp Down Duration (s)</label>
                                <input type="number" id="signup-ramp-down" value="3" min="1" max="60" onchange="updateK6Config('signup')">
                            </div>
                        </div>

                        <button class="copy-btn" onclick="copyK6Script('signup-k6-output')">üìã Copy K6 Script</button>
                        <div class="k6-script-output" id="signup-k6-output"></div>
                    </div>

                    <div class="response-section" id="signup-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="signup-response-body"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Coupon Section -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('coupon-section')">
            <h2>coupon</h2>
            <span class="expand-icon" id="coupon-icon">‚ñº</span>
        </div>
        <div class="section-content" id="coupon-section">

            <!-- Coupon List API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('coupon-list-api')">
                    <div class="api-left">
                        <span class="method-badge method-get">GET</span>
                        <span class="api-path">/list</span>
                        <span class="api-description">Ïø†Ìè∞ Î¶¨Ïä§Ìä∏ (Ïú†Ï†Ä)</span>
                    </div>
                    <span class="expand-icon" id="coupon-list-icon">‚ñº</span>
                </div>
                <div class="api-details" id="coupon-list-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>Ïù¥Î≤§Ìä∏ Ïø†Ìè∞ Î¶¨Ïä§Ìä∏Í∞Ä Î≥¥ÏûÑ</p>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('GET', '/list', null, 'coupon-list-response')">
                            Execute API
                        </button>
                        <button class="k6-btn" onclick="toggleK6Section('coupon-list')">
                            ‚ö° K6 Load Test
                        </button>
                    </div>

                    <div class="k6-section" id="coupon-list-k6-section">
                        <h5>K6 Load Test Configuration</h5>

                        <div class="k6-stats">
                            <h6>üìä Test Overview</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="coupon-list-total-duration">11s</div>
                                    <div class="stat-label">Total Duration</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="coupon-list-max-users">1000</div>
                                    <div class="stat-label">Max Users</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="coupon-list-total-requests">~5000</div>
                                    <div class="stat-label">Est. Requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="k6-config-grid">
                            <div class="k6-config-item">
                                <label>üöÄ Ramp Up Duration (s)</label>
                                <input type="number" id="coupon-list-ramp-up" value="3" min="1" max="60" onchange="updateK6Config('coupon-list')">
                            </div>
                            <div class="k6-config-item">
                                <label>üë• Target Users</label>
                                <input type="number" id="coupon-list-target-users" value="1000" min="1" max="10000" onchange="updateK6Config('coupon-list')">
                            </div>
                            <div class="k6-config-item">
                                <label>‚è±Ô∏è Hold Duration (s)</label>
                                <input type="number" id="coupon-list-hold-duration" value="5" min="1" max="300" onchange="updateK6Config('coupon-list')">
                            </div>
                            <div class="k6-config-item">
                                <label>üìâ Ramp Down Duration (s)</label>
                                <input type="number" id="coupon-list-ramp-down" value="3" min="1" max="60" onchange="updateK6Config('coupon-list')">
                            </div>
                        </div>

                        <button class="copy-btn" onclick="copyK6Script('coupon-list-k6-output')">üìã Copy K6 Script</button>
                        <div class="k6-script-output" id="coupon-list-k6-output"></div>
                    </div>

                    <div class="response-section" id="coupon-list-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="coupon-list-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- Get Coupon API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('get-coupon-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/get</span>
                        <span class="api-description">Ïø†Ìè∞ Î∞õÍ∏∞ (Ïú†Ï†Ä)</span>
                    </div>
                    <span class="expand-icon" id="get-coupon-icon">‚ñº</span>
                </div>
                <div class="api-details" id="get-coupon-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>Ïù¥Î≤§Ìä∏ Ïø†Ìè∞ Î∞õÍ∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÏÉùÍ∏∞Îäî Ïù¥Î≤§Ìä∏</p>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="getCouponRequest">CouponRequest (JSON)</label>
                            <textarea id="getCouponRequest" placeholder="Enter JSON request body">{
  "id": 62,
  "userId": 1
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "id": 62,
                            "userId": 1
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/get', 'getCouponRequest', 'get-coupon-response')">
                            Execute API
                        </button>
                        <button class="k6-btn" onclick="toggleK6Section('get-coupon')">
                            ‚ö° K6 Load Test
                        </button>
                    </div>

                    <div class="k6-section" id="get-coupon-k6-section">
                        <h5>K6 Load Test Configuration</h5>

                        <div class="k6-stats">
                            <h6>üìä Test Overview</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="get-coupon-total-duration">11s</div>
                                    <div class="stat-label">Total Duration</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="get-coupon-max-users">3000</div>
                                    <div class="stat-label">Max Users</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="get-coupon-total-requests">~15000</div>
                                    <div class="stat-label">Est. Requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="k6-config-grid">
                            <div class="k6-config-item">
                                <label>üöÄ Ramp Up Duration (s)</label>
                                <input type="number" id="get-coupon-ramp-up" value="3" min="1" max="60" onchange="updateK6Config('get-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>üë• Target Users</label>
                                <input type="number" id="get-coupon-target-users" value="3000" min="1" max="10000" onchange="updateK6Config('get-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>‚è±Ô∏è Hold Duration (s)</label>
                                <input type="number" id="get-coupon-hold-duration" value="5" min="1" max="300" onchange="updateK6Config('get-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>üìâ Ramp Down Duration (s)</label>
                                <input type="number" id="get-coupon-ramp-down" value="3" min="1" max="60" onchange="updateK6Config('get-coupon')">
                            </div>
                        </div>

                        <button class="copy-btn" onclick="copyK6Script('get-coupon-k6-output')">üìã Copy K6 Script</button>
                        <div class="k6-script-output" id="get-coupon-k6-output"></div>
                    </div>

                    <div class="response-section" id="get-coupon-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="get-coupon-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- Issue Coupon API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('issue-coupon-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/issue</span>
                        <span class="api-description">Ïø†Ìè∞ Î∞úÍ∏â (Ïñ¥ÎìúÎØº)</span>
                    </div>
                    <span class="expand-icon" id="issue-coupon-icon">‚ñº</span>
                </div>
                <div class="api-details" id="issue-coupon-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>Ïñ¥ÎìúÎØº ÌéòÏù¥ÏßÄÏóêÏÑú Ìï¥Îãπ Ïø†Ìè∞ Î∞úÍ∏â</p>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="issueCouponRequest">CouponsRequest (JSON)</label>
                            <textarea id="issueCouponRequest" placeholder="Enter JSON request body">{
  "name": "Ïã†Í∑ú Í∞ÄÏûÖ Ï∂ïÌïò Ïø†Ìè∞",
  "quantity": 5000,
  "discount_rate": 10
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "name": "Ïã†Í∑ú Í∞ÄÏûÖ Ï∂ïÌïò Ïø†Ìè∞",
                            "quantity": 5000,
                            "discount_rate": 10,
                            "starts_at": "2025-07-3"
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/issue', 'issueCouponRequest', 'issue-coupon-response')">
                            Execute API
                        </button>
                        <button class="k6-btn" onclick="toggleK6Section('issue-coupon')">
                            ‚ö° K6 Load Test
                        </button>
                    </div>

                    <div class="k6-section" id="issue-coupon-k6-section">
                        <h5>K6 Load Test Configuration</h5>

                        <div class="k6-stats">
                            <h6>üìä Test Overview</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="issue-coupon-total-duration">11s</div>
                                    <div class="stat-label">Total Duration</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="issue-coupon-max-users">10</div>
                                    <div class="stat-label">Max Users</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="issue-coupon-total-requests">~25</div>
                                    <div class="stat-label">Est. Requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="k6-config-grid">
                            <div class="k6-config-item">
                                <label>üöÄ Ramp Up Duration (s)</label>
                                <input type="number" id="issue-coupon-ramp-up" value="3" min="1" max="60" onchange="updateK6Config('issue-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>üë• Target Users</label>
                                <input type="number" id="issue-coupon-target-users" value="10" min="1" max="10000" onchange="updateK6Config('issue-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>‚è±Ô∏è Hold Duration (s)</label>
                                <input type="number" id="issue-coupon-hold-duration" value="5" min="1" max="300" onchange="updateK6Config('issue-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>üìâ Ramp Down Duration (s)</label>
                                <input type="number" id="issue-coupon-ramp-down" value="3" min="1" max="60" onchange="updateK6Config('issue-coupon')">
                            </div>
                        </div>

                        <button class="copy-btn" onclick="copyK6Script('issue-coupon-k6-output')">üìã Copy K6 Script</button>
                        <div class="k6-script-output" id="issue-coupon-k6-output"></div>
                    </div>

                    <div class="response-section" id="issue-coupon-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="issue-coupon-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- All Get Coupon API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('all-get-coupon-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/allGet</span>
                        <span class="api-description">Î™®Îì† Ïú†Ï†ÄÏóêÍ≤å Ïø†Ìè∞ Î∞úÍ∏â</span>
                    </div>
                    <span class="expand-icon" id="all-get-coupon-icon">‚ñº</span>
                </div>
                <div class="api-details" id="all-get-coupon-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>Î™®Îì† Ïú†Ï†ÄÏóêÍ≤å Ïø†Ìè∞ÏùÑ Î∞úÍ∏â</p>
                    </div>

                    <div class="detail-section">
                        <h4>Parameters</h4>
                        <div class="form-group">
                            <label for="allGetCouponId">couponId (Query Parameter)</label>
                            <input type="number" id="allGetCouponId" placeholder="Enter coupon ID" value="1">
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeAllGetRequest()">
                            Execute API
                        </button>
                        <button class="k6-btn" onclick="toggleK6Section('all-get-coupon')">
                            ‚ö° K6 Load Test
                        </button>
                    </div>

                    <div class="k6-section" id="all-get-coupon-k6-section">
                        <h5>K6 Load Test Configuration</h5>

                        <div class="k6-stats">
                            <h6>üìä Test Overview</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="all-get-coupon-total-duration">11s</div>
                                    <div class="stat-label">Total Duration</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="all-get-coupon-max-users">5</div>
                                    <div class="stat-label">Max Users</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="all-get-coupon-total-requests">~5</div>
                                    <div class="stat-label">Est. Requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="k6-config-grid">
                            <div class="k6-config-item">
                                <label>üöÄ Ramp Up Duration (s)</label>
                                <input type="number" id="all-get-coupon-ramp-up" value="3" min="1" max="60" onchange="updateK6Config('all-get-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>üë• Target Users</label>
                                <input type="number" id="all-get-coupon-target-users" value="5" min="1" max="10000" onchange="updateK6Config('all-get-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>‚è±Ô∏è Hold Duration (s)</label>
                                <input type="number" id="all-get-coupon-hold-duration" value="5" min="1" max="300" onchange="updateK6Config('all-get-coupon')">
                            </div>
                            <div class="k6-config-item">
                                <label>üìâ Ramp Down Duration (s)</label>
                                <input type="number" id="all-get-coupon-ramp-down" value="3" min="1" max="60" onchange="updateK6Config('all-get-coupon')">
                            </div>
                        </div>

                        <button class="copy-btn" onclick="copyK6Script('all-get-coupon-k6-output')">üìã Copy K6 Script</button>
                        <div class="k6-script-output" id="all-get-coupon-k6-output"></div>
                    </div>

                    <div class="response-section" id="all-get-coupon-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="all-get-coupon-response-body"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Global K6 script templates
    const k6Templates = {
        login: (baseUrl, config) => `import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '${config.rampUp}s', target: ${config.targetUsers} }, // Ï†êÏßÑÏ†Å Ï¶ùÍ∞Ä
        { duration: '${config.holdDuration}s', target: ${config.targetUsers} }, // ÏµúÎåÄ Î∂ÄÌïò Ïú†ÏßÄ
        { duration: '${config.rampDown}s', target: 0 },    // Ï†êÏßÑÏ†Å Í∞êÏÜå
    ],
    thresholds: {
        http_req_duration: ['p(95)<1000'], // 95% ÏöîÏ≤≠Ïù¥ 1Ï¥à Ïù¥ÎÇ¥
        http_req_failed: ['rate<0.1'],     // Ïã§Ìå®Ïú® 10% ÎØ∏Îßå
    },
};

export default function () {
    const userId = __VU;
    const payload = JSON.stringify({
        username: \`user\${userId}@example.com\`,
        password: 'password123'
    });

    const params = {
        headers: { 'Content-Type': 'application/json' },
        timeout: '60s',
    };

    let res = http.post('${baseUrl}/api/login', payload, params);

    check(res, {
        'status is 200': (r) => r.status === 200,
        'login successful': (r) => r.status === 200,
        'response time OK': (r) => r.timings.duration < 2000,
    });

    console.log(\`üë§ User \${userId} login - Status: \${res.status}, Time: \${Math.round(res.timings.duration)}ms\`);
    sleep(1);
}`,

        signup: (baseUrl, config) => `import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '${config.rampUp}s', target: ${config.targetUsers} },
        { duration: '${config.holdDuration}s', target: ${config.targetUsers} },
        { duration: '${config.rampDown}s', target: 0 },
    ],
    thresholds: {
        http_req_duration: ['p(95)<2000'],
        http_req_failed: ['rate<0.1'],
    },
};

export default function () {
    const userId = __VU;
    const timestamp = Date.now();
    const payload = JSON.stringify({
        username: \`newuser\${userId}_\${timestamp}@example.com\`,
        password: 'password123'
    });

    const params = {
        headers: { 'Content-Type': 'application/json' },
        timeout: '60s',
    };

    let res = http.post('${baseUrl}/api/signup', payload, params);

    check(res, {
        'status is 200 or 201': (r) => r.status === 200 || r.status === 201,
        'signup successful': (r) => r.status === 200 || r.status === 201,
        'response time OK': (r) => r.timings.duration < 3000,
    });

    console.log(\`‚úÖ User \${userId} signup - Status: \${res.status}, Time: \${Math.round(res.timings.duration)}ms\`);
    sleep(1);
}`,

        'coupon-list': (baseUrl, config) => `import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '${config.rampUp}s', target: ${config.targetUsers} },
        { duration: '${config.holdDuration}s', target: ${config.targetUsers} },
        { duration: '${config.rampDown}s', target: 0 },
    ],
    thresholds: {
        http_req_duration: ['p(95)<500'],  // GET ÏöîÏ≤≠ÏùÄ Îçî Îπ®ÎùºÏïº Ìï®
        http_req_failed: ['rate<0.05'],
    },
};

export default function () {
    const userId = __VU;

    const params = {
        timeout: '30s',
    };

    let res = http.get('${baseUrl}/list', params);

    check(res, {
        'status is 200': (r) => r.status === 200,
        'response time < 500ms': (r) => r.timings.duration < 500,
        'has coupon data': (r) => r.body && r.body.length > 0,
        'valid JSON response': (r) => {
            try {
                JSON.parse(r.body);
                return true;
            } catch (e) {
                return false;
            }
        },
    });

    console.log(\`üìã User \${userId} fetched coupon list - Status: \${res.status}, Time: \${Math.round(res.timings.duration)}ms\`);
    sleep(1);
}`,

        'get-coupon': (baseUrl, config) => `import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '${config.rampUp}s', target: ${config.targetUsers} }, // ${config.rampUp}Ï¥à ÎèôÏïà Ï†êÏßÑÏ†ÅÏúºÎ°ú ${config.targetUsers}Î™Ö Ï¶ùÍ∞Ä
        { duration: '${config.holdDuration}s', target: ${config.targetUsers} }, // ${config.holdDuration}Ï¥à ÎèôÏïà Ïú†ÏßÄ
        { duration: '${config.rampDown}s', target: 0 },    // ${config.rampDown}Ï¥à ÎèôÏïà Ï†êÏßÑÏ†ÅÏúºÎ°ú Ï§ÑÏù¥Í∏∞
    ],
    thresholds: {
        http_req_duration: ['p(95)<3000'], // 95% ÏöîÏ≤≠Ïù¥ 3Ï¥à Ïù¥ÎÇ¥
        http_req_failed: ['rate<0.5'],     // Ïã§Ìå®Ïú® 50% ÎØ∏Îßå (ÎèôÏãúÏÑ± ÌÖåÏä§Ìä∏Ïù¥ÎØÄÎ°ú ÎÜíÍ≤å ÏÑ§Ï†ï)
    },
};

export default function () {
    const userId = __VU - 1; // 0Î∂ÄÌÑ∞ ÏãúÏûëÌïòÎäî userId
    const payload = JSON.stringify({
        id: 32,    // Ïø†Ìè∞ ID
        userId: userId,
    });

    const params = {
        headers: { 'Content-Type': 'application/json' },
        timeout: '60s',
    };

    let res = http.post('${baseUrl}/api/get', payload, params);

    check(res, {
        'status was 200 or 500': (r) => r.status === 200 || r.status === 500,
        'request processed': (r) => r.status !== 0,
        'response received': (r) => r.body !== undefined,
    });

    console.log(\`üé´ User \${userId} tried to get coupon - Status: \${res.status}, Time: \${Math.round(res.timings.duration)}ms\`);
    sleep(1);
}`,

        'issue-coupon': (baseUrl, config) => `import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '${config.rampUp}s', target: ${config.targetUsers} },
        { duration: '${config.holdDuration}s', target: ${config.targetUsers} },
        { duration: '${config.rampDown}s', target: 0 },
    ],
    thresholds: {
        http_req_duration: ['p(95)<5000'], // Ïñ¥ÎìúÎØº ÏûëÏóÖÏùÄ Îçî Ïò§Îûò Í±∏Î¶¥ Ïàò ÏûàÏùå
        http_req_failed: ['rate<0.1'],
    },
};

export default function () {
    const adminId = __VU;
    const timestamp = Date.now();

    const payload = JSON.stringify({
        name: \`Load Test Coupon \${adminId}_\${timestamp}\`,
        quantity: 1000,
        discount_rate: 10,
        starts_at: new Date().toISOString().split('T')[0]
    });

    const params = {
        headers: { 'Content-Type': 'application/json' },
        timeout: '60s',
    };

    let res = http.post('${baseUrl}/api/issue', payload, params);

    check(res, {
        'status is 200 or 201': (r) => r.status === 200 || r.status === 201,
        'coupon issued successfully': (r) => r.status === 200 || r.status === 201,
        'response time OK': (r) => r.timings.duration < 5000,
    });

    console.log(\`üè≠ Admin \${adminId} issued coupon - Status: \${res.status}, Time: \${Math.round(res.timings.duration)}ms\`);
    sleep(2); // Ïñ¥ÎìúÎØº ÏûëÏóÖÏù¥ÎØÄÎ°ú Îçî Í∏¥ ÎåÄÍ∏∞ÏãúÍ∞Ñ
}`,

        'all-get-coupon': (baseUrl, config) => `import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '${config.rampUp}s', target: ${config.targetUsers} },
        { duration: '${config.holdDuration}s', target: ${config.targetUsers} },
        { duration: '${config.rampDown}s', target: 0 },
    ],
    thresholds: {
        http_req_duration: ['p(95)<10000'], // ÎåÄÎüâ ÏûëÏóÖÏù¥ÎØÄÎ°ú 10Ï¥àÍπåÏßÄ ÌóàÏö©
        http_req_failed: ['rate<0.1'],
    },
};

export default function () {
    const adminId = __VU;
    const couponId = 1; // ÌÖåÏä§Ìä∏Ìï† Ïø†Ìè∞ ID

    const params = {
        headers: { 'Content-Type': 'application/json' },
        timeout: '120s', // ÎåÄÎüâ ÏûëÏóÖÏù¥ÎØÄÎ°ú Í∏¥ ÌÉÄÏûÑÏïÑÏõÉ
    };

    let res = http.post(\`${baseUrl}/api/allGet?couponId=\${couponId}\`, null, params);

    check(res, {
        'status is 200': (r) => r.status === 200,
        'bulk operation completed': (r) => r.status === 200,
        'response time acceptable': (r) => r.timings.duration < 10000,
    });

    console.log(\`üöÄ Admin \${adminId} triggered bulk coupon distribution for coupon \${couponId} - Status: \${res.status}, Time: \${Math.round(res.timings.duration)}ms\`);
    sleep(5); // ÎåÄÎüâ ÏûëÏóÖÏù¥ÎØÄÎ°ú Í∏¥ ÎåÄÍ∏∞ÏãúÍ∞Ñ
}`
    };

    // Utility functions
    function toggleSection(sectionId) {
        const content = document.getElementById(sectionId);
        const icon = document.getElementById(sectionId.replace('-section', '-icon'));

        if (content.classList.contains('active')) {
            content.classList.remove('active');
            icon.classList.remove('rotated');
        } else {
            content.classList.add('active');
            icon.classList.add('rotated');
        }
    }

    function toggleApi(apiId) {
        const details = document.getElementById(apiId);
        const header = details.previousElementSibling;
        const icon = header.querySelector('.expand-icon');

        if (details.classList.contains('active')) {
            details.classList.remove('active');
            header.classList.remove('expanded');
            icon.classList.remove('rotated');
        } else {
            details.classList.add('active');
            header.classList.add('expanded');
            icon.classList.add('rotated');
        }
    }

    function toggleK6Section(apiType) {
        const k6Section = document.getElementById(`${apiType}-k6-section`);

        if (k6Section.classList.contains('show')) {
            k6Section.classList.remove('show');
        } else {
            k6Section.classList.add('show');
            generateK6Script(apiType);
        }
    }

    function updateK6Config(apiType) {
        const rampUp = parseInt(document.getElementById(`${apiType}-ramp-up`).value);
        const targetUsers = parseInt(document.getElementById(`${apiType}-target-users`).value);
        const holdDuration = parseInt(document.getElementById(`${apiType}-hold-duration`).value);
        const rampDown = parseInt(document.getElementById(`${apiType}-ramp-down`).value);

        // Update stats display
        const totalDuration = rampUp + holdDuration + rampDown;
        const estimatedRequests = Math.round(targetUsers * holdDuration * 0.8); // Rough estimate

        document.getElementById(`${apiType}-total-duration`).textContent = `${totalDuration}s`;
        document.getElementById(`${apiType}-max-users`).textContent = targetUsers;
        document.getElementById(`${apiType}-total-requests`).textContent = `~${estimatedRequests}`;

        // Regenerate script
        generateK6Script(apiType);
    }

    function generateK6Script(apiType) {
        const baseUrl = document.getElementById('baseUrl').value.trim();
        const config = {
            rampUp: document.getElementById(`${apiType}-ramp-up`).value,
            targetUsers: document.getElementById(`${apiType}-target-users`).value,
            holdDuration: document.getElementById(`${apiType}-hold-duration`).value,
            rampDown: document.getElementById(`${apiType}-ramp-down`).value
        };

        const script = k6Templates[apiType](baseUrl, config);
        document.getElementById(`${apiType}-k6-output`).textContent = script;
    }

    function copyK6Script(outputId) {
        const output = document.getElementById(outputId);
        const textArea = document.createElement('textarea');
        textArea.value = output.textContent;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);

        // Show feedback
        const copyBtn = output.previousElementSibling;
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        copyBtn.classList.add('copied');

        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('copied');
        }, 2000);
    }

    // API execution functions
    async function executeRequest(method, endpoint, bodyId, responseId) {
        const baseUrl = document.getElementById('baseUrl').value.trim();
        const url = baseUrl + endpoint;

        let requestBody = null;

        if (bodyId) {
            const bodyText = document.getElementById(bodyId).value.trim();
            if (bodyText) {
                try {
                    requestBody = JSON.parse(bodyText);
                } catch (e) {
                    showResponse(responseId, `JSON ÌååÏã± Ïò§Î•ò: ${e.message}`, 'error');
                    return;
                }
            }
        }

        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            }
        };

        if (requestBody) {
            options.body = JSON.stringify(requestBody);
        }

        try {
            showResponse(responseId, 'ÏöîÏ≤≠ Ï§ë...', 'loading');

            const response = await fetch(url, options);

            let responseText = '';
            const contentType = response.headers.get('content-type');

            if (contentType && contentType.includes('application/json')) {
                const jsonData = await response.json();
                responseText = JSON.stringify(jsonData, null, 2);
            } else {
                responseText = await response.text();
            }

            const statusText = `HTTP ${response.status} ${response.statusText}`;
            const fullResponse = `${statusText}\n\n${responseText || 'ÏùëÎãµ Î≥∏Î¨∏ ÏóÜÏùå'}`;

            showResponse(responseId, fullResponse, response.ok ? 'success' : 'error');

        } catch (error) {
            showResponse(responseId, `ÏöîÏ≤≠ Ïã§Ìå®: ${error.message}`, 'error');
        }
    }

    async function executeAllGetRequest() {
        const baseUrl = document.getElementById('baseUrl').value.trim();
        const couponId = document.getElementById('allGetCouponId').value;
        const url = `${baseUrl}/api/allGet?couponId=${couponId}`;

        const options = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        };

        try {
            showResponse('all-get-coupon-response', 'ÏöîÏ≤≠ Ï§ë...', 'loading');

            const response = await fetch(url, options);

            let responseText = '';
            const contentType = response.headers.get('content-type');

            if (contentType && contentType.includes('application/json')) {
                const jsonData = await response.json();
                responseText = JSON.stringify(jsonData, null, 2);
            } else {
                responseText = await response.text();
            }

            const statusText = `HTTP ${response.status} ${response.statusText}`;
            const fullResponse = `${statusText}\n\n${responseText || 'ÏùëÎãµ Î≥∏Î¨∏ ÏóÜÏùå'}`;

            showResponse('all-get-coupon-response', fullResponse, response.ok ? 'success' : 'error');

        } catch (error) {
            showResponse('all-get-coupon-response', `ÏöîÏ≤≠ Ïã§Ìå®: ${error.message}`, 'error');
        }
    }

    function showResponse(responseId, content, type) {
        const responseDiv = document.getElementById(responseId);
        const responseBody = document.getElementById(responseId + '-body');

        responseDiv.classList.add('show');
        responseBody.textContent = content;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Open first section by default
        toggleSection('user-section');

        // Initialize all K6 configurations
        const apiTypes = ['login', 'signup', 'coupon-list', 'get-coupon', 'issue-coupon', 'all-get-coupon'];
        apiTypes.forEach(apiType => {
            updateK6Config(apiType);
        });

        // Add welcome message
        console.log(`
üöÄ API Documentation with K6 Load Testing Ready!

üìã Available APIs:
‚Ä¢ Login/Signup (User management)
‚Ä¢ Coupon List (Read operations)
‚Ä¢ Get Coupon (High concurrency testing)
‚Ä¢ Issue Coupon (Admin operations)
‚Ä¢ All Get Coupon (Bulk operations)

‚ö° K6 Features:
‚Ä¢ Real-time script generation
‚Ä¢ Configurable load patterns
‚Ä¢ Performance thresholds
‚Ä¢ Detailed logging
‚Ä¢ Copy-paste ready scripts

üí° Usage:
1. Click "‚ö° K6 Load Test" on any API
2. Adjust test parameters
3. Copy the generated script
4. Run: k6 run script.js

Happy Load Testing! üéØ
        `);
    });

    // Add keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + K to toggle K6 sections
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            const visibleK6Sections = document.querySelectorAll('.k6-section.show');
            if (visibleK6Sections.length > 0) {
                visibleK6Sections.forEach(section => section.classList.remove('show'));
            } else {
                // Show the first available K6 section
                const firstK6Button = document.querySelector('.k6-btn');
                if (firstK6Button) {
                    firstK6Button.click();
                }
            }
        }
    });

    // Add URL validation
    document.getElementById('baseUrl').addEventListener('blur', function() {
        const url = this.value.trim();
        if (url && !url.match(/^https?:\/\/.+/)) {
            this.style.borderColor = '#f44336';
            this.title = 'URL should start with http:// or https://';
        } else {
            this.style.borderColor = '';
            this.title = '';
        }
    });

    // Performance monitoring for the page itself
    window.addEventListener('load', function() {
        const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
        console.log(`üìä Page loaded in ${loadTime}ms`);
    });
</script>

<!-- Easter egg: Konami code for developer mode -->
<script>
    let konamiCode = [];
    const konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];

    document.addEventListener('keydown', function(e) {
        konamiCode.push(e.keyCode);
        if (konamiCode.length > konami.length) {
            konamiCode.shift();
        }

        if (konamiCode.toString() === konami.toString()) {
            console.log(`
    üéÆ KONAMI CODE ACTIVATED!

    üîß Developer Mode Enabled:
    ‚Ä¢ Enhanced logging activated
    ‚Ä¢ Debug mode on
    ‚Ä¢ Performance metrics visible
    ‚Ä¢ Secret K6 configs unlocked

    üöÄ Extreme Load Test Presets:
    ‚Ä¢ Beast Mode: 10,000 users
    ‚Ä¢ Chaos Mode: Random intervals
    ‚Ä¢ Endurance Mode: 30 minute tests

    Type 'beast()' for 10k user presets
    Type 'chaos()' for random configurations
    Type 'endurance()' for long-running tests
            `);

            // Add global functions for extreme testing
            window.beast = function() {
                const inputs = document.querySelectorAll('.k6-config-item input[id*="target-users"]');
                inputs.forEach(input => input.value = 10000);
                console.log('ü¶æ BEAST MODE: All APIs set to 10,000 users!');
            };

            window.chaos = function() {
                const configs = ['ramp-up', 'target-users', 'hold-duration', 'ramp-down'];
                configs.forEach(config => {
                    const inputs = document.querySelectorAll(`.k6-config-item input[id*="${config}"]`);
                    inputs.forEach(input => {
                        const randomValue = Math.floor(Math.random() * 100) + 1;
                        input.value = randomValue;
                    });
                });
                console.log('üå™Ô∏è CHAOS MODE: Random configurations applied!');
            };

            window.endurance = function() {
                const holdInputs = document.querySelectorAll('.k6-config-item input[id*="hold-duration"]');
                holdInputs.forEach(input => input.value = 1800); // 30 minutes
                console.log('üèÉ‚Äç‚ôÇÔ∏è ENDURANCE MODE: 30-minute load tests configured!');
            };
        }
    });
</script>

</body>
</html>