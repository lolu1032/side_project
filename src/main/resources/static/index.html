<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Platform APIs with K6 Load Testing</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <div class="header">
        <div class="header-content">
            <div>
                <div class="title-section">
                    <h1>Web Platform APIs</h1>
                    <span class="version-badge">v1</span>
                    <span class="spec-badge">OAS3</span>
                    <span class="k6-badge">K6 READY</span>
                </div>
                <div class="url-info">/openapi/web.json - Load Testing Enabled</div>
            </div>
            <button class="authorize-btn">
                Authorize 🔒
            </button>
        </div>
    </div>

    <div class="base-url-section">
        <div class="form-group">
            <label for="baseUrl">Base URL:</label>
            <input type="text" id="baseUrl" value="http://localhost:8080" placeholder="Enter base URL">
        </div>
    </div>

    <!-- User Section -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('user-section')">
            <h2>user</h2>
            <span class="expand-icon" id="user-icon">▼</span>
        </div>
        <div class="section-content" id="user-section">

            <!-- Login API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('login-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/login</span>
                        <span class="api-description">로그인</span>
                    </div>
                    <span class="expand-icon" id="login-icon">▼</span>
                </div>
                <div class="api-details" id="login-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>로그인 로직</p>
                        <div class="error-section">
                          <div class="error-section-title">
                            <span>API Error Responses</span>
                            <span class="error-desc">아래는 로그인 시 발생할 수 있는 에러 코드와 메시지입니다.</span>
                          </div>
                          <ul class="error-list-box">
                            <li><span class="error-badge error-400">400</span> <span class="error-code-name">EMPTY_USERNAME</span> <span class="error-msg">아이디를 입력하세요.</span></li>
                            <li><span class="error-badge error-400">400</span> <span class="error-code-name">EMPTY_PASSWORD</span> <span class="error-msg">비밀번호를 입력하세요.</span></li>
                            <li><span class="error-badge error-404">404</span> <span class="error-code-name">NOT_FOUNT_USERNAME</span> <span class="error-msg">아이디가 존재하지않습니다.</span></li>
                            <li><span class="error-badge error-401">401</span> <span class="error-code-name">PASSWORD_MISMATCH</span> <span class="error-msg">비밀번호가 일치하지 않습니다.</span></li>
                            <li><span class="error-badge error-500">500</span> <span class="error-code-name">DEFAULT</span> <span class="error-msg">서버 에러</span></li>
                          </ul>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="loginRequest">loginRequest (JSON)</label>
                            <textarea id="loginRequest" placeholder="Enter JSON request body">{
  "username": "user@example.com",
  "password": "password123"
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "username": "user@example.com",
                            "password": "password123"
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/login', 'loginRequest', 'login-response')">
                            Execute API
                        </button>
                    </div>

                    <div class="response-section" id="login-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="login-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- Signup API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('signup-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/signup</span>
                        <span class="api-description">회원가입</span>
                    </div>
                    <span class="expand-icon" id="signup-icon">▼</span>
                </div>
                <div class="api-details" id="signup-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>회원가입 로직</p>
                        <div class="error-section">
                          <div class="error-section-title">
                            <span class="error-icon">🚨</span>
                            <span>API Error Responses</span>
                            <span class="error-desc">아래는 회원가입 시 발생할 수 있는 에러 코드와 메시지입니다.</span>
                          </div>
                          <div class="error-table-wrap">
                            <table class="error-table">
                              <thead>
                                <tr>
                                  <th>코드</th>
                                  <th>에러명</th>
                                  <th>메시지</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr><td>400</td><td>EMPTY_USERNAME</td><td>아이디를 입력하세요.</td></tr>
                                <tr><td>400</td><td>INVALID_USERNAME</td><td>아이디는 4자 이상 20자 이하로 입력해야 합니다.</td></tr>
                                <tr><td>400</td><td>EMPTY_PASSWORD</td><td>비밀번호를 입력하세요.</td></tr>
                                <tr><td>400</td><td>INVALID_PASSWORD_LENGTH</td><td>비밀번호는 8자 이상 30자 이하로 입력해야 합니다.</td></tr>
                                <tr><td>400</td><td>PASSWORD_NO_NUMBER</td><td>비밀번호는 최소 하나 이상의 숫자를 포함해야 합니다.</td></tr>
                                <tr><td>400</td><td>PASSWORD_NO_LETTER</td><td>비밀번호는 최소 하나 이상의 영문자를 포함해야 합니다.</td></tr>
                                <tr><td>400</td><td>PASSWORD_NO_SPECIAL</td><td>비밀번호는 최소 하나 이상의 특수문자를 포함해야 합니다.</td></tr>
                                <tr><td>409</td><td>DUPLICATE_USERNAM</td><td>이미 존재하는 아이디입니다.</td></tr>
                                <tr><td>500</td><td>DEFAULT</td><td>서버 에러</td></tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="signupRequest">signupRequest (JSON)</label>
                            <textarea id="signupRequest" placeholder="Enter JSON request body">{
  "username": "newuser@example.com",
  "password": "password123"
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "username": "newuser@example.com",
                            "password": "password123"
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/signup', 'signupRequest', 'signup-response')">
                            Execute API
                        </button>
                    </div>

                    <div class="response-section" id="signup-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="signup-response-body"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Coupon Section -->
    <div class="section">
        <div class="section-header" onclick="toggleSection('coupon-section')">
            <h2>coupon</h2>
            <span class="expand-icon" id="coupon-icon">▼</span>
        </div>
        <div class="section-content" id="coupon-section">

            <!-- Coupon List API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('coupon-list-api')">
                    <div class="api-left">
                        <span class="method-badge method-get">GET</span>
                        <span class="api-path">/list</span>
                        <span class="api-description">쿠폰 리스트 (유저)</span>
                    </div>
                    <span class="expand-icon" id="coupon-list-icon">▼</span>
                </div>
                <div class="api-details" id="coupon-list-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>이벤트 쿠폰 리스트가 보임</p>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('GET', '/list', null, 'coupon-list-response')">
                            Execute API
                        </button>
                    </div>

                    <div class="response-section" id="coupon-list-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="coupon-list-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- Get Coupon API - WITH K6 TESTING -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('get-coupon-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/get</span>
                        <span class="api-description">쿠폰 받기 (유저)</span>
                        <span style="background: #ff6b35; color: white; padding: 2px 6px; border-radius: 8px; font-size: 10px; margin-left: 10px;">K6 READY</span>
                    </div>
                    <span class="expand-icon" id="get-coupon-icon">▼</span>
                </div>
                <div class="api-details" id="get-coupon-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>이벤트 쿠폰 받기 버튼 클릭 시 생기는 이벤트</p>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="getCouponRequest">CouponRequest (JSON)</label>
                            <textarea id="getCouponRequest" placeholder="Enter JSON request body">{
  "id": 62,
  "userId": 1
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "id": 62,
                            "userId": 1
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/get', 'getCouponRequest', 'get-coupon-response')">
                            Execute API
                        </button>
                        <button class="k6-btn" onclick="toggleK6Section('get-coupon')">
                            ⚡ K6 Load Test
                        </button>
                    </div>

                    <div class="k6-section" id="get-coupon-k6-section">
                        <h5>K6 Load Test Configuration</h5>

                        <div class="k6-stats">
                            <h6>📊 Test Overview</h6>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="get-coupon-total-duration">11s</div>
                                    <div class="stat-label">Total Duration</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="get-coupon-max-users">3000</div>
                                    <div class="stat-label">Max Users</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="get-coupon-total-requests">~15000</div>
                                    <div class="stat-label">Est. Requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="k6-config-grid">
                            <div class="k6-config-item">
                                <label>🚀 Ramp Up Duration (s)</label>
                                <input type="number" id="get-coupon-ramp-up" value="3" min="1" max="60" onchange="updateK6Config()">
                            </div>
                            <div class="k6-config-item">
                                <label>👥 Target Users</label>
                                <input type="number" id="get-coupon-target-users" value="3000" min="1" max="10000" onchange="updateK6Config()">
                            </div>
                            <div class="k6-config-item">
                                <label>⏱️ Hold Duration (s)</label>
                                <input type="number" id="get-coupon-hold-duration" value="5" min="1" max="300" onchange="updateK6Config()">
                            </div>
                            <div class="k6-config-item">
                                <label>📉 Ramp Down Duration (s)</label>
                                <input type="number" id="get-coupon-ramp-down" value="3" min="1" max="60" onchange="updateK6Config()">
                            </div>
                        </div>

                        <div class="button-group">
                            <button class="copy-btn" onclick="copyK6Script()">📋 Copy K6 Script</button>
                            <button class="run-btn" id="runK6Btn" onclick="runK6Test()">▶️ Run Test</button>
                            <button class="copy-btn" onclick="resetK6Script()">🔄 Reset Script</button>
                        </div>

                        <div class="k6-script-editor">
                            <textarea id="k6ScriptEditor" placeholder="K6 script will be generated here..."></textarea>
                        </div>

                        <div class="execution-output" id="executionOutput" style="display: none;">
                            <div id="outputContent">Ready to run test...</div>
                        </div>
                    </div>

                    <div class="response-section" id="get-coupon-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="get-coupon-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- Issue Coupon API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('issue-coupon-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/issue</span>
                        <span class="api-description">쿠폰 발급 (어드민)</span>
                    </div>
                    <span class="expand-icon" id="issue-coupon-icon">▼</span>
                </div>
                <div class="api-details" id="issue-coupon-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>어드민 페이지에서 해당 쿠폰 발급</p>
                    </div>

                    <div class="detail-section">
                        <h4>Request Body</h4>
                        <div class="form-group">
                            <label for="issueCouponRequest">CouponsRequest (JSON)</label>
                            <textarea id="issueCouponRequest" placeholder="Enter JSON request body">{
  "name": "신규 가입 축하 쿠폰",
  "quantity": 5000,
  "discount_rate": 10
}</textarea>
                        </div>
                        <div class="json-example">Example:
                            {
                            "name": "신규 가입 축하 쿠폰",
                            "quantity": 5000,
                            "discount_rate": 10,
                            "starts_at": "2025-07-3"
                            }</div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeRequest('POST', '/api/issue', 'issueCouponRequest', 'issue-coupon-response')">
                            Execute API
                        </button>
                    </div>

                    <div class="response-section" id="issue-coupon-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="issue-coupon-response-body"></div>
                    </div>
                </div>
            </div>

            <!-- All Get Coupon API -->
            <div class="api-item">
                <div class="api-header" onclick="toggleApi('all-get-coupon-api')">
                    <div class="api-left">
                        <span class="method-badge method-post">POST</span>
                        <span class="api-path">/api/allGet</span>
                        <span class="api-description">모든 유저에게 쿠폰 발급</span>
                    </div>
                    <span class="expand-icon" id="all-get-coupon-icon">▼</span>
                </div>
                <div class="api-details" id="all-get-coupon-api">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>모든 유저에게 쿠폰을 발급</p>
                    </div>

                    <div class="detail-section">
                        <h4>Parameters</h4>
                        <div class="form-group">
                            <label for="allGetCouponId">couponId (Query Parameter)</label>
                            <input type="number" id="allGetCouponId" placeholder="Enter coupon ID" value="1">
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="execute-btn" onclick="executeAllGetRequest()">
                            Execute API
                        </button>
                    </div>

                    <div class="response-section" id="all-get-coupon-response">
                        <div class="response-header">Response</div>
                        <div class="response-body" id="all-get-coupon-response-body"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let testRunning = false;
    let testInterval = null;

    // K6 script template for get-coupon
    function generateK6Script() {
        const baseUrl = document.getElementById('baseUrl').value.trim();
        const requestBody = document.getElementById('getCouponRequest').value.trim();

        let couponData;
        try {
            couponData = JSON.parse(requestBody);
        } catch (e) {
            couponData = { id: 62, userId: 1 };
        }

        const config = {
            rampUp: document.getElementById('get-coupon-ramp-up').value,
            targetUsers: document.getElementById('get-coupon-target-users').value,
            holdDuration: document.getElementById('get-coupon-hold-duration').value,
            rampDown: document.getElementById('get-coupon-ramp-down').value
        };

        const script = `import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '${config.rampUp}s', target: ${config.targetUsers} }, // ${config.rampUp}초 동안 점진적으로 ${config.targetUsers}명 증가
        { duration: '${config.holdDuration}s', target: ${config.targetUsers} }, // ${config.holdDuration}초 동안 유지
        { duration: '${config.rampDown}s', target: 0 },    // ${config.rampDown}초 동안 점진적으로 줄이기
    ],
    thresholds: {
        http_req_duration: ['p(95)<3000'], // 95% 요청이 3초 이내
        http_req_failed: ['rate<0.5'],     // 실패율 50% 미만 (동시성 테스트이므로 높게 설정)
        http_reqs: ['rate>100'],           // 초당 100개 이상의 요청
    },
};

export default function () {
    const userId = __VU; // Virtual User ID
    const payload = JSON.stringify({
        id: ${couponData.id},    // 쿠폰 ID
        userId: userId,
    });

    const params = {
        headers: { 'Content-Type': 'application/json' },
        timeout: '60s',
    };

    let res = http.post('${baseUrl}/api/get', payload, params);

    // 응답 검증
    check(res, {
        'status was 200 or 500': (r) => r.status === 200 || r.status === 500,
        'request processed': (r) => r.status !== 0,
        'response received': (r) => r.body !== undefined,
        'response time < 5s': (r) => r.timings.duration < 5000,
    });

    // 상세 로깅
    const status = res.status;
    const duration = Math.round(res.timings.duration);
    const timestamp = new Date().toISOString().split('T')[1].split('.')[0];

    if (status === 200) {
        console.log(\`✅ [\${timestamp}] User \${userId} got coupon - Status: \${status}, Time: \${duration}ms\`);
    } else if (status === 500) {
        console.log(\`❌ [\${timestamp}] User \${userId} failed (likely out of stock) - Status: \${status}, Time: \${duration}ms\`);
    } else {
        console.log(\`⚠️  [\${timestamp}] User \${userId} unexpected response - Status: \${status}, Time: \${duration}ms\`);
    }

    // 사용자 행동 시뮬레이션 (1-3초 사이 랜덤 대기)
    sleep(Math.random() * 2 + 1);
}

// 테스트 시작 시 실행
export function setup() {
    console.log('🚀 Starting coupon load test...');
    console.log(\`📊 Target: \${${config.targetUsers}} users over \${${parseInt(config.rampUp) + parseInt(config.holdDuration) + parseInt(config.rampDown)}} seconds\`);
    console.log(\`🎯 Coupon ID: \${${couponData.id}}\`);
    console.log(\`🌐 Base URL: ${baseUrl}\`);
    return {};
}

// 테스트 종료 시 실행
export function teardown(data) {
    console.log('🏁 Load test completed!');
    console.log('📈 Check the summary for detailed results');
}`;

        document.getElementById('k6ScriptEditor').value = script;
        return script;
    }

    function updateK6Config() {
        const rampUp = parseInt(document.getElementById('get-coupon-ramp-up').value) || 0;
        const targetUsers = parseInt(document.getElementById('get-coupon-target-users').value) || 0;
        const holdDuration = parseInt(document.getElementById('get-coupon-hold-duration').value) || 0;
        const rampDown = parseInt(document.getElementById('get-coupon-ramp-down').value) || 0;

        const totalDuration = rampUp + holdDuration + rampDown;
        const estimatedRequests = Math.round(targetUsers * holdDuration * 0.8);

        document.getElementById('get-coupon-total-duration').textContent = `${totalDuration}s`;
        document.getElementById('get-coupon-max-users').textContent = targetUsers;
        document.getElementById('get-coupon-total-requests').textContent = `~${estimatedRequests}`;

        generateK6Script();
    }

    function resetK6Script() {
        generateK6Script();
        showOutput('Script reset to default template');
    }

    function copyK6Script() {
        const script = document.getElementById('k6ScriptEditor').value;
        const textArea = document.createElement('textarea');
        textArea.value = script;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);

        const copyBtn = event.target;
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '✅ Copied!';
        copyBtn.classList.add('copied');

        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('copied');
        }, 2000);
    }

    function runK6Test() {
        if (testRunning) {
            stopK6Test();
            return;
        }

        testRunning = true;
        const runBtn = document.getElementById('runK6Btn');
        runBtn.textContent = '⏹️ Stop Test';
        runBtn.style.background = '#f44336';

        const outputDiv = document.getElementById('executionOutput');
        outputDiv.style.display = 'block';

        clearOutput();
        showOutput('🚀 Starting K6 load test simulation...');
        showOutput('Note: This is a browser simulation. For real K6 testing, copy script and run with K6 CLI.');
        showOutput('');

        simulateK6Test();
    }

    function stopK6Test() {
        testRunning = false;
        if (testInterval) {
            clearInterval(testInterval);
            testInterval = null;
        }

        const runBtn = document.getElementById('runK6Btn');
        runBtn.textContent = '▶️ Run Test';
        runBtn.style.background = '#4caf50';

        showOutput('');
        showOutput('⏹️ Test stopped by user');
    }

    function simulateK6Test() {
        const targetUsers = parseInt(document.getElementById('get-coupon-target-users').value);
        const totalDuration = parseInt(document.getElementById('get-coupon-ramp-up').value) +
                             parseInt(document.getElementById('get-coupon-hold-duration').value) +
                             parseInt(document.getElementById('get-coupon-ramp-down').value);

        let currentTime = 0;
        let totalRequests = 0;
        let successfulRequests = 0;
        let failedRequests = 0;

        testInterval = setInterval(() => {
            if (!testRunning) return;

            currentTime++;
            const progress = (currentTime / totalDuration) * 100;

            // Simulate test metrics
            const currentVUs = Math.min(currentTime * (targetUsers / 10), targetUsers);
            const requestsThisSecond = Math.floor(currentVUs * (0.5 + Math.random() * 0.5));
            const successRate = Math.random() * 0.4 + 0.6; // 60-100% success rate
            const successful = Math.floor(requestsThisSecond * successRate);
            const failed = requestsThisSecond - successful;

            totalRequests += requestsThisSecond;
            successfulRequests += successful;
            failedRequests += failed;

            const avgDuration = Math.round(Math.random() * 1500 + 500); // 500-2000ms

            if (currentTime % 2 === 0) {
                showOutput(`📊 [${currentTime}s] VUs: ${Math.floor(currentVUs)}, RPS: ${requestsThisSecond}, Success: ${successful}, Failed: ${failed}, Avg: ${avgDuration}ms`);
            }

            // Show summary every 10 seconds
            if (currentTime % 10 === 0) {
                const overallSuccessRate = ((successfulRequests / totalRequests) * 100).toFixed(1);
                showOutput(`📈 [Summary] Total: ${totalRequests}, Success Rate: ${overallSuccessRate}%, Failed: ${failedRequests}`);
                showOutput('');
            }

            if (currentTime >= totalDuration) {
                clearInterval(testInterval);
                testRunning = false;

                const runBtn = document.getElementById('runK6Btn');
                runBtn.textContent = '▶️ Run Test';
                runBtn.style.background = '#4caf50';

                showOutput('');
                showOutput('✅ Load test simulation completed!');
                showOutput(`📊 Final Results:`);
                showOutput(`   Total Requests: ${totalRequests}`);
                showOutput(`   Successful: ${successfulRequests} (${((successfulRequests/totalRequests)*100).toFixed(1)}%)`);
                showOutput(`   Failed: ${failedRequests} (${((failedRequests/totalRequests)*100).toFixed(1)}%)`);
                showOutput(`   Duration: ${totalDuration}s`);
                showOutput('');
                showOutput('💡 For real performance data, copy the script and run with K6 CLI:');
                showOutput('   k6 run script.js');
            }
        }, 1000);
    }

    function showOutput(message) {
        const output = document.getElementById('outputContent');
        if (message === '') {
            output.textContent += '\n';
        } else {
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
        }
        output.scrollTop = output.scrollHeight;
    }

    function clearOutput() {
        document.getElementById('outputContent').textContent = '';
    }

    // Utility functions
    function toggleSection(sectionId) {
        const content = document.getElementById(sectionId);
        const icon = document.getElementById(sectionId.replace('-section', '-icon'));

        if (content.classList.contains('active')) {
            content.classList.remove('active');
            icon.classList.remove('rotated');
        } else {
            content.classList.add('active');
            icon.classList.add('rotated');
        }
    }

    function toggleApi(apiId) {
        const details = document.getElementById(apiId);
        const header = details.previousElementSibling;
        const icon = header.querySelector('.expand-icon');

        if (details.classList.contains('active')) {
            details.classList.remove('active');
            header.classList.remove('expanded');
            icon.classList.remove('rotated');
        } else {
            details.classList.add('active');
            header.classList.add('expanded');
            icon.classList.add('rotated');
        }
    }

    function toggleK6Section(apiType) {
        const k6Section = document.getElementById(`${apiType}-k6-section`);

        if (k6Section.classList.contains('show')) {
            k6Section.classList.remove('show');
        } else {
            k6Section.classList.add('show');
            generateK6Script();
        }
    }

    // API execution functions
    async function executeRequest(method, endpoint, bodyId, responseId) {
        const baseUrl = document.getElementById('baseUrl').value.trim();
        const url = baseUrl + endpoint;

        let requestBody = null;

        if (bodyId) {
            const bodyText = document.getElementById(bodyId).value.trim();
            if (bodyText) {
                try {
                    requestBody = JSON.parse(bodyText);
                } catch (e) {
                    showResponse(responseId, `JSON 파싱 오류: ${e.message}`, 'error');
                    return;
                }
            }
        }

        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            }
        };

        if (requestBody) {
            options.body = JSON.stringify(requestBody);
        }

        try {
            showResponse(responseId, '요청 중...', 'loading');

            const response = await fetch(url, options);

            let responseText = '';
            const contentType = response.headers.get('content-type');

            if (contentType && contentType.includes('application/json')) {
                const jsonData = await response.json();
                responseText = JSON.stringify(jsonData, null, 2);
            } else {
                responseText = await response.text();
            }

            const statusText = `HTTP ${response.status} ${response.statusText}`;
            const fullResponse = `${statusText}\n\n${responseText || '응답 본문 없음'}`;

            showResponse(responseId, fullResponse, response.ok ? 'success' : 'error');

        } catch (error) {
            showResponse(responseId, `요청 실패: ${error.message}`, 'error');
        }
    }

    async function executeAllGetRequest() {
        const baseUrl = document.getElementById('baseUrl').value.trim();
        const couponId = document.getElementById('allGetCouponId').value;
        const url = `${baseUrl}/api/allGet?couponId=${couponId}`;

        const options = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        };

        try {
            showResponse('all-get-coupon-response', '요청 중...', 'loading');

            const response = await fetch(url, options);

            let responseText = '';
            const contentType = response.headers.get('content-type');

            if (contentType && contentType.includes('application/json')) {
                const jsonData = await response.json();
                responseText = JSON.stringify(jsonData, null, 2);
            } else {
                responseText = await response.text();
            }

            const statusText = `HTTP ${response.status} ${response.statusText}`;
            const fullResponse = `${statusText}\n\n${responseText || '응답 본문 없음'}`;

            showResponse('all-get-coupon-response', fullResponse, response.ok ? 'success' : 'error');

        } catch (error) {
            showResponse('all-get-coupon-response', `요청 실패: ${error.message}`, 'error');
        }
    }

    function showResponse(responseId, content, type) {
        const responseDiv = document.getElementById(responseId);
        const responseBody = document.getElementById(responseId + '-body');

        responseDiv.classList.add('show');
        responseBody.textContent = content;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Open user section by default
        toggleSection('user-section');

        // Initialize K6 configuration
        updateK6Config();

        // Auto-update script when request body changes
        document.getElementById('getCouponRequest').addEventListener('input', generateK6Script);
        document.getElementById('baseUrl').addEventListener('input', generateK6Script);

        console.log(`
🚀 Web Platform APIs with K6 Load Testing Ready!

📋 Available APIs:
• Login/Signup (User management)
• Coupon List (Read operations)
• Get Coupon (⚡ K6 Load Testing Enabled)
• Issue Coupon (Admin operations)
• All Get Coupon (Bulk operations)

⚡ K6 Features (Get Coupon API only):
• Real-time script generation
• Editable script with syntax highlighting
• Browser-based test simulation
• Configurable load patterns
• Performance metrics display

💡 Usage:
1. Navigate to Get Coupon API
2. Click "⚡ K6 Load Test"
3. Configure test parameters
4. Modify the K6 script if needed
5. Click "Run Test" for simulation
6. Copy script for real K6 testing

Happy API Testing! 🎯
        `);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'Enter':
                    e.preventDefault();
                    if (document.getElementById('get-coupon-k6-section').classList.contains('show')) {
                        runK6Test();
                    }
                    break;
                case 'r':
                    e.preventDefault();
                    if (document.getElementById('get-coupon-k6-section').classList.contains('show')) {
                        resetK6Script();
                    }
                    break;
                case 'c':
                    e.preventDefault();
                    if (document.getElementById('get-coupon-k6-section').classList.contains('show')) {
                        copyK6Script();
                    }
                    break;
            }
        }
    });

    // Auto-save script changes
    document.getElementById('k6ScriptEditor').addEventListener('input', function() {
        localStorage.setItem('k6-custom-script', this.value);
    });

    // Load saved script on page load
    window.addEventListener('load', function() {
        const savedScript = localStorage.getItem('k6-custom-script');
        if (savedScript && savedScript.trim()) {
            document.getElementById('k6ScriptEditor').value = savedScript;
        }
    });

    // Add URL validation
    document.getElementById('baseUrl').addEventListener('blur', function() {
        const url = this.value.trim();
        if (url && !url.match(/^https?:\/\/.+/)) {
            this.style.borderColor = '#f44336';
            this.title = 'URL should start with http:// or https://';
        } else {
            this.style.borderColor = '';
            this.title = '';
        }
    });
</script>

</body>
</html>